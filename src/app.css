@import './theme.css';

* { box-sizing:border-box; }
html, body { height:100%; }
/* Slight global font-size bump for readability */
html { font-size:17px; }
body {
	margin:0;
	font-family: system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,'Open Sans','Helvetica Neue',sans-serif;
	background: var(--color-bg);
	color: var(--color-text);
	-webkit-font-smoothing: antialiased;
	overflow-x:hidden; /* prevent whole-page horizontal scroll */
}

h1,h2,h3,h4 { font-weight:600; line-height:1.2; margin:0; }
p { line-height:1.55; }

a { color: var(--color-accent); text-decoration:none; }
a:hover { text-decoration:underline; }

.app-shell {
	display:grid;
	grid-template-columns: 1fr;
	gap: 28px;
	max-width: 1680px;
	margin: 0 auto;
	padding: 28px clamp(16px, 3vw, 48px) 80px;
	position:relative;
}

@media (max-width: 1100px) {
	.app-shell { grid-template-columns: 1fr; padding-bottom:120px; }
	.sidebar { position:static; }
}

.sidebar {
	display: none; /* Hide sidebar to give full width to main content */
}

.sidebar.compact { gap:12px; }
.sidebar.compact .surface.compact-block { padding:12px 14px 14px; }
.sidebar.compact .load-block { padding:10px 12px 12px; }
.sidebar.compact .search-block input { font-size:.7rem; padding:8px 32px 8px 10px; }
.sidebar.compact .nav-block { padding:12px 14px 10px; }
.sidebar.compact .calls-block { flex:1 1 auto; display:flex; flex-direction:column; padding:10px 10px 12px; }
.sidebar.compact .calls-block .calls-panel { flex:1 1 auto; height:100%; max-height:none; }

.surface {
	background: var(--color-surface);
	border:1px solid var(--color-border);
	border-radius: var(--radius-md);
	padding:18px 20px 20px;
	box-shadow: var(--shadow-sm);
	position:relative;
	transition: box-shadow var(--transition), border-color var(--transition);
}
.surface:hover { box-shadow: var(--shadow-md); }

.header-main { 
  grid-column: 1 / -1; 
  margin-bottom: 20px; 
}

/* Split workspace layout */
.workspace-split {
  display: grid;
  grid-template-columns: 380px 1fr;
  gap: 20px;
  align-items: start;
  width: 100%;
  min-height: 70vh;
}

.overview-pane {
  position: sticky;
  top: 20px;
  height: calc(100vh - 40px); /* ensures child 100% heights map to viewport */
  overflow: visible;
  padding: 4px 2px 8px 2px;
  scrollbar-width: thin;
  display:flex;
  flex-direction:column;
}
.overview-pane::-webkit-scrollbar { width:8px; }
.overview-pane::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 10px; }
.overview-pane::-webkit-scrollbar-thumb:hover { background: var(--color-border-strong); }

.overview-pane .calls-panel { box-shadow: var(--shadow-sm); }
.overview-pane .calls-panel:hover { box-shadow: var(--shadow-md); }

/* Left column stack */
.left-stack { display:flex; flex-direction:column; gap:14px; min-height:0; flex:1; }
.global-status.perm { position:relative; box-shadow: var(--shadow-sm); }
.ingest-block .drag-drop { width:100%; }

/* (Deprecated) in-stack global status hidden after moving to fixed nav-left-wrapper */
.left-stack .global-status.side { display:none !important; }

/* Ingest block follows status; keep subtle divider */
.left-stack .ingest-block { background: var(--color-surface); padding:4px 0 8px; border-bottom:1px dashed var(--color-border); }

/* Dedicated scroll container for tool calls so ingest block doesn't scroll */
.left-stack .toolcalls-scroll { position:relative; overflow:visible; flex:1 1 auto; min-height:0; padding-top:8px; }
.left-stack .toolcalls-scroll::-webkit-scrollbar { width:8px; }
.left-stack .toolcalls-scroll::-webkit-scrollbar-thumb { background: var(--color-border); border-radius:10px; }

@media (max-width: 1000px) {
  .left-stack .global-status.side { position:static; }
}

/* Ensure drag-drop always same width as overview panel (fill parent) */
.overview-pane .ingest-block { width:100%; }
.overview-pane .ingest-block .drag-drop { width:100%; }

/* Ingest + Filters grid inside overview pane */
.ingest-filters-grid { 
  display:grid; 
  grid-template-columns: 1fr 2fr; 
  gap:16px; 
  align-items:start; 
  width:100%; 
  margin-bottom: 10px;
}
.ingest-filters-grid .ingest-block { 
  padding:0; 
  background: var(--color-surface); 
  border:1px dashed var(--color-border); 
  border-radius: var(--radius-md); 
  /* Match two 48px search rows + 12px gap = 108px */
  min-height:108px; 
  display:flex; 
  align-items:stretch; 
  justify-content:stretch; 
  box-shadow: var(--shadow-sm);
}
.ingest-filters-grid .ingest-block .drag-drop { 
  min-height:108px; 
  font-size:.82rem; 
  border:none; 
  background:linear-gradient(135deg,var(--color-surface),rgba(255,255,255,0.7)); 
  border-radius: var(--radius-md); 
  display:flex; 
  align-items:center; 
  justify-content:center; 
}
.ingest-filters-grid .filters-stack { 
  display:grid; 
  grid-template-rows: auto auto; 
  gap:12px; 
}
.ingest-filters-grid .filters-stack .search-bar { 
  background: var(--color-surface); 
  border:1px solid var(--color-border); 
  border-radius: var(--radius-md); 
  padding:0 14px; 
  height: 48px; 
  display:flex; 
  align-items:center; 
  box-shadow: var(--shadow-sm); 
  transition: box-shadow var(--transition), border-color var(--transition); 
}
.ingest-filters-grid .filters-stack .search-bar:focus-within { 
  border-color: var(--color-accent);
  box-shadow: 0 0 0 2px rgba(37,99,235,.18);
}
.ingest-filters-grid .filters-stack .search-bar input { 
  height: 100% !important; 
  border: none !important; 
  outline: none; 
  background: transparent; 
  padding: 0 40px 0 8px !important; 
  font-size: .9rem; 
}
.ingest-filters-grid .filters-stack .search-bar input:focus { box-shadow:none !important; }
.ingest-filters-grid .filters-stack .search-bar button.clear { 
  top: 50% !important; 
  transform: translateY(-50%); 
  right: 8px !important; 
  width: 28px !important; 
  height: 28px !important; 
  border-radius: 50% !important; 
  padding: 0 !important; 
  display:flex; align-items:center; justify-content:center; 
  background: var(--color-border);
}
.ingest-filters-grid .filters-stack .search-bar:hover { 
  box-shadow: var(--shadow-md); 
  border-color: var(--color-accent); 
}
@media (max-width: 1200px) { 
  .ingest-filters-grid { grid-template-columns: 1fr; } 
  .ingest-filters-grid .filters-stack { grid-template-columns:1fr 1fr; grid-template-rows:auto; } 
}
@media (max-width: 700px) { 
  .ingest-filters-grid .filters-stack { grid-template-columns:1fr; } 
}

/* Filters full-width on right side matching RequestDetail width */
.filters-block { margin:0 0 16px; }
.filters-block .filters-row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
.filters-block .search-bar { background: var(--color-surface); border:1px solid var(--color-border); border-radius: var(--radius-md); padding:12px 16px; box-shadow: var(--shadow-sm); }
.filters-block .search-bar:hover { box-shadow: var(--shadow-md); border-color: var(--color-accent); }

@media (max-width: 1100px) {
  .filters-block .filters-row { grid-template-columns:1fr; }
}

/* Compact status inside top controls */
.global-status { display:flex; flex-direction:column; gap:6px; align-items:flex-start; justify-content:flex-start; padding:4px 10px; background: var(--color-surface); border:1px solid var(--color-border); border-radius: var(--radius-md); box-shadow: var(--shadow-sm); min-width:130px; }
.global-status .status-item { display:flex; gap:6px; align-items:center; font-size:.6rem; }
.global-status .label { font-size:.55rem; text-transform:uppercase; letter-spacing:.6px; font-weight:600; color: var(--color-text-soft); }
.global-status .count-mini { background: var(--color-accent-soft); color: var(--color-accent); padding:2px 6px; border-radius:10px; font-weight:600; font-size:.55rem; letter-spacing:.4px; }

/* Empty mode side placement */
.empty-global-status-wrapper { position:fixed; left:20px; top:120px; z-index:60; }
.global-status.side { min-width:110px; }
.global-status.inline { align-self:stretch; }

/* Stretch drag-drop when empty (no requests) */
.top-controls.empty-layout .ingest.stretch-full { flex:1 1 100%; }
.top-controls.empty-layout .ingest .drag-drop { min-height:120px; font-size:1rem; }

/* Workspace empty mode adjustments */
.workspace-split.empty-mode { grid-template-columns: 380px 1fr; }
.workspace-split.empty-mode .overview-empty-placeholder { border:2px dashed var(--color-border); border-radius: var(--radius-md); padding:20px 18px; background:linear-gradient(135deg,var(--color-surface),rgba(255,255,255,0.6)); min-height:240px; display:flex; align-items:center; }
.overview-empty-placeholder .placeholder-hint { font-size:.7rem; color: var(--color-text-soft); margin:0; }
.empty-state.tall { min-height:400px; display:flex; flex-direction:column; justify-content:center; }

/* Adjust existing main-content now that it sits inside split */
.workspace-split .main-content { padding:0; }
.workspace-split .main-content .panel { margin-top:0; }

@media (max-width: 1300px) {
  .workspace-split { grid-template-columns: 340px 1fr; }
}
@media (max-width: 1150px) {
  .workspace-split { grid-template-columns: 300px 1fr; }
}
@media (max-width: 1000px) {
  .workspace-split { grid-template-columns: 1fr; }
  .overview-pane { position: static; max-height:none; padding:0; }
}
@media (prefers-color-scheme: dark) {
  .global-status { background:#1f2730; border-color: var(--color-border-strong); }
  .overview-pane { scrollbar-color: var(--color-border-strong) transparent; }
}

.calls-top-bar { margin-top:24px; background: linear-gradient(90deg,var(--color-surface),rgba(255,255,255,0.6)); border:1px solid var(--color-border); border-radius: var(--radius-md); padding:14px 0 12px; box-shadow: var(--shadow-sm); overflow:hidden; position:relative; }
.calls-top-bar.full-bleed { width:100%; }
.calls-top-bar .calls-panel { margin:0; }
.calls-top-bar .chips.top-flow { display:flex; flex-wrap:nowrap; gap:8px; overflow-x:auto; overflow-y:hidden; padding:6px 20px 12px; scrollbar-width:thin; }
.calls-top-bar .chips.top-flow::-webkit-scrollbar { height:8px; }
.calls-top-bar .chips.top-flow::-webkit-scrollbar-track { background:transparent; }
.calls-top-bar .chips.top-flow::-webkit-scrollbar-thumb { background: var(--color-border); border-radius:20px; }
.calls-top-bar .chips.top-flow button.topchip { flex:0 0 auto; }
.calls-top-bar::after { content:""; position:absolute; right:0; top:0; bottom:0; width:40px; pointer-events:none; background:linear-gradient(270deg, var(--color-surface) 0%, rgba(255,255,255,0) 100%); }

@media (max-width: 1100px) {
	.calls-top-bar { position:sticky; top:0; z-index:50; backdrop-filter: blur(8px); margin-top:12px; border-radius:0; border-left:none; border-right:none; }
	.calls-top-bar::after { width:50px; }
}

@media (prefers-color-scheme: dark) {
	.calls-top-bar::after { background:linear-gradient(270deg, var(--color-surface) 0%, rgba(30,39,49,0) 100%); }
}

.page-title { font-size: clamp(1.9rem, 2.4vw, 2.6rem); letter-spacing:-.5px; background:linear-gradient(90deg,var(--color-accent),var(--color-info)); -webkit-background-clip:text; background-clip:text; color:transparent; }
.subtitle { color: var(--color-text-soft); font-size: .95rem; margin-top:6px; }

/* Top controls (ingest + filters) */
.top-controls { margin-top:24px; display:flex; gap:18px; align-items:stretch; }
.top-controls .ingest { flex:0 0 300px; display:flex; }
.top-controls .ingest .drag-drop { flex:1; display:flex; flex-direction:column; justify-content:center; margin:0; }
.top-controls .filters { flex:1 1 auto; display:grid; grid-template-rows:1fr 1fr; gap:12px; align-items:stretch; }
.top-controls .filters .search-bar { 
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: 12px 16px;
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--transition), border-color var(--transition);
}
.top-controls .filters .search-bar:hover {
  box-shadow: var(--shadow-md);
  border-color: var(--color-accent);
}
.top-controls .filters .search-bar input { 
  height:100%; 
  background: transparent;
  border: none;
  outline: none;
  width: 100%;
  font-size: 0.9rem;
}

/* Side navigation buttons */
.nav-side {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  z-index: 100;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.nav-left-all {
  left: 20px;
}

.nav-right-filtered {
  right: 20px;
}

/* Filtered status near right navigator */
.nav-right-filtered .nav-side-status { 
  position: static; 
  margin-bottom: 6px; 
  padding: 6px 10px; 
}

/* Wrapper to position global status above left navigator */
/* New independent fixed elements for left status + centered navigator */
.nav-left-status {
  position:fixed;
  left:20px;
  z-index:130;
  /* top is dynamically set via JS for vertical alignment */
  transition: top .25s ease, opacity .25s ease;
}
.nav-left-nav {
  position:fixed;
  left:20px;
  width:auto;
  z-index:120;
  /* top dynamically set via JS for perfect centering */
  transition: top .25s ease, opacity .25s ease;
  transform:none !important; /* override .nav-side default translate */
}
.nav-left-status, .nav-left-nav { pointer-events:auto; }
@media (max-width:1100px){
  .nav-left-status, .nav-left-nav { position:static; top:auto !important; left:auto; transform:none; }
  .nav-left-nav { display:none; }
}

.nav-buttons-row {
  display: flex;
  gap: 10px;
}

.nav-group-label {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  color: var(--color-text-soft);
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 4px 8px;
  border-radius: 12px;
  box-shadow: var(--shadow-sm);
}

.nav-side-btn {
  border: none;
  color: #fff;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-all-btn {
  background: var(--color-accent, #2563eb);
}

.nav-filtered-btn {
  background: var(--color-success, #059669);
}

.nav-side-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.nav-side-btn:active {
  transform: translateY(0);
}

.nav-side-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
}

/* Center navigation bar spanning content width */
.nav-center-bar { 
  margin-top:18px; 
  display:flex; 
  justify-content:center; 
  position: fixed; 
  top: 20px; 
  left: 50%; 
  transform: translateX(-50%); 
  z-index: 100; 
  padding: 0; 
}
.nav-status-center {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(12px);
  border: 1px solid var(--color-border);
  padding: 10px 20px;
  border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  gap: 16px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-item .label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-text-soft);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-item .count {
  background: var(--color-accent-soft);
  color: var(--color-accent);
  padding: 4px 8px;
  border-radius: var(--radius-pill);
  font-size: 0.75rem;
  font-weight: 600;
  min-width: 60px;
  text-align: center;
}

.status-separator {
  color: var(--color-text-soft);
  opacity: 0.5;
}

@media (max-width: 1100px) {
	.top-controls { flex-wrap:wrap; }
	.nav-side {
	  display: none;
	}
	
	.nav-center-bar {
	  position: sticky;
	  top: 10px;
	  z-index: 50;
	}
	
	.back-to-top {
	  width: 45px;
	  height: 45px;
	  bottom: 20px;
	  right: 20px;
	}
}
@media (max-width: 900px) {
	.top-controls { flex-direction:column; gap:14px; }
	.top-controls .ingest { flex:1 1 auto; }
	.top-controls .filters { grid-template-rows: auto auto; gap:10px; }
	.top-controls .filters .search-bar { width:100%; }
	
	.back-to-top {
	  width: 40px;
	  height: 40px;
	  bottom: 15px;
	  right: 15px;
	}
}

::-webkit-scrollbar { width:10px; height:10px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background: var(--color-border); border-radius:20px; }
::-webkit-scrollbar-thumb:hover { background: var(--color-border-strong); }

button { font-family: inherit; }
button:not([disabled]) { cursor:pointer; }

.btn, button.primary {
	background: var(--color-accent);
	color:#fff; border:none; padding:10px 16px; border-radius: var(--radius-sm);
	font-size:.9rem; font-weight:500; letter-spacing:.3px; display:inline-flex; align-items:center; gap:6px;
	box-shadow: var(--shadow-sm); position:relative; transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
}
.btn:hover, button.primary:hover { background: var(--color-accent-hover); box-shadow: var(--shadow-md); }
.btn:active { transform: translateY(1px); box-shadow: var(--shadow-sm); }
.btn[disabled] { background: var(--color-border); color: var(--color-text-soft); cursor:not-allowed; box-shadow:none; }

.btn.outline { background:transparent; border:1px solid var(--color-border); color: var(--color-text); }
.btn.outline:hover { border-color: var(--color-accent); color: var(--color-accent); }

.section-label { font-size:.75rem; font-weight:600; letter-spacing:.7px; text-transform:uppercase; color: var(--color-text-soft); margin:0 0 10px; }

.chip-cloud { display:flex; flex-wrap:wrap; gap:8px; }
.chip { padding:6px 12px; background: var(--color-accent-soft); color: var(--color-accent); font-size:.75rem; font-weight:600; border-radius: var(--radius-pill); text-transform:uppercase; letter-spacing:.5px; }

.function-calls-panel h3 { font-size:1.05rem; margin:0 0 14px; font-weight:600; letter-spacing:.3px; }

.calls-wrap { display:flex; flex-wrap:wrap; gap:8px; }
.calls-wrap button { border:none; padding:8px 14px; font-size:.75rem; font-weight:600; letter-spacing:.4px; border-radius: var(--radius-pill); color:#fff; box-shadow: var(--shadow-sm); position:relative; backdrop-filter: blur(4px); }
.calls-wrap button.selected { outline:2px solid rgba(255,255,255,.9); box-shadow:0 0 0 3px var(--color-accent-soft), var(--shadow-md); }
.calls-wrap button:focus-visible { outline:2px solid #fff; outline-offset:2px; }

.panel { background: var(--color-surface); border:1px solid var(--color-border); border-radius: var(--radius-md); padding:22px 26px 28px; box-shadow: var(--shadow-sm); position:relative; }
.panel:not(:last-child) { margin-bottom:28px; }
.panel header { margin-bottom:18px; display:flex; flex-wrap:wrap; gap:12px; align-items:baseline; }
.panel header .meta { font-size:.75rem; color: var(--color-text-soft); }

.code-block, pre { background: var(--color-code-bg); color: var(--color-code-text); padding:10px 12px; border-radius: var(--radius-sm); font-family: var(--font-mono); font-size:.8rem; line-height:1.4; overflow:auto; position:relative; border:1px solid var(--color-border); white-space:pre-wrap; word-break:break-word; overflow-wrap:anywhere; }
.code-block::-webkit-scrollbar, pre::-webkit-scrollbar { height:8px; }

.message-card { border:1px solid var(--color-border); padding:14px 16px 16px; border-radius: var(--radius-sm); background:linear-gradient(180deg,var(--color-surface),rgba(255,255,255,0.6)); position:relative; box-shadow: var(--shadow-sm); }
.message-card.user { background: linear-gradient(180deg,#ecf5ff,#ffffff); }
.message-card.assistant { background: linear-gradient(180deg,#ebfdf4,#ffffff); }
.message-card.system { background: linear-gradient(180deg,#f1f5f9,#ffffff); font-style:italic; }
.message-card.tool { background: linear-gradient(180deg,#fff9e6,#ffffff); }
.message-card:not(:last-child) { margin-bottom:14px; }
.message-card .role { font-size:.65rem; font-weight:700; letter-spacing:.8px; color: var(--color-text-soft); text-transform:uppercase; margin-bottom:6px; }

.fn-call-list { list-style:none; margin:0; padding:0; }
.fn-call-list li { border:1px solid var(--color-border); border-radius: var(--radius-sm); padding:12px 14px 16px; background:linear-gradient(180deg,var(--color-surface),rgba(255,255,255,0.55)); box-shadow: var(--shadow-sm); position:relative; }
.fn-call-list li + li { margin-top:14px; }
.fn-call-list li.highlight { border-color: var(--color-warning); box-shadow:0 0 0 2px rgba(234,179,8,.25); background:linear-gradient(180deg,#fff8e1,var(--color-surface)); }
.fn-call-header { display:flex; align-items:center; gap:10px; margin-bottom:6px; }
.fn-tag { background: var(--color-accent-soft); color: var(--color-accent); padding:4px 8px; border-radius: var(--radius-pill); font-size:.65rem; font-weight:600; letter-spacing:.5px; }
.selected-badge { color: var(--color-warning); font-weight:600; font-size:.7rem; }

.diff-container { background: var(--color-surface); border:1px solid var(--color-border); border-radius: var(--radius-sm); overflow:hidden; box-shadow: var(--shadow-sm); }
.diff-header {
  background: var(--color-accent);
  color: #fff;
  padding: 8px 12px;
  font-size: .7rem;
  font-weight: 600;
  letter-spacing: 0;
  text-transform: none;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  overflow-wrap: anywhere;
  word-break: break-word;
  white-space: normal;
}

/* manage_todo_list rendered view */
.todo-container { display:flex; flex-direction:column; gap:4px; }
.todo-container .diff-header { padding: 4px 8px; font-size: .6rem; }
.todo-body { border:1px solid var(--color-border); border-radius: var(--radius-sm); background: var(--color-surface); box-shadow: none; overflow:hidden; }
.todo-item { padding:4px 8px; border-top:1px solid rgba(0,0,0,0.06); }
.todo-item:first-child { border-top:none; }
.todo-line { display:flex; gap:6px; align-items:flex-start; line-height: 1.15; }
.todo-box { font-family: var(--font-mono); color: var(--color-text-soft); flex: 0 0 auto; }
.todo-title { font-family: var(--font-mono); color: var(--color-text); overflow-wrap:anywhere; word-break:break-word; font-size: .8rem; }
.todo-id { color: var(--color-text-soft); }
.todo-desc { margin-left: 22px; margin-top: 1px; font-size:.68rem; color: var(--color-text-soft); line-height:1.2; }
.todo-item.completed .todo-title { text-decoration: line-through; opacity: .85; }
.todo-item.in-progress { background: rgba(13, 148, 136, 0.08); }
.todo-item.completed { background: rgba(22, 163, 74, 0.06); }
.diff-section h4 { margin:0; font-size:.7rem; letter-spacing:.5px; padding:6px 10px; }
.diff-old { background:#fef2f2; border-left:4px solid var(--color-danger); }
.diff-old h4 { color:#991b1b; }
.diff-new { background:#ecfdf3; border-left:4px solid var(--color-success); }
.diff-new h4 { color:#166534; }
.diff-content { padding:12px 14px; font-family: var(--font-mono); font-size:.75rem; line-height:1.4; white-space:pre-wrap; max-height:300px; overflow:auto; }

.inline-controls { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px; }
.mini-btn { background: var(--color-info); border:none; color:#fff; font-size:.65rem; padding:6px 10px; border-radius: var(--radius-pill); font-weight:600; letter-spacing:.5px; }
.mini-btn.alt { background: var(--color-accent); }
.mini-btn.warning { background: var(--color-warning); }
.mini-btn:hover { filter: brightness(.95); }
.mini-btn:active { transform:translateY(1px); }

.search-bar { position:relative; }
.search-bar input { width:100%; padding:10px 38px 10px 14px; border:1px solid var(--color-border); background: var(--color-surface); border-radius: var(--radius-sm); font-size:.85rem; transition: border-color var(--transition), background var(--transition); }
.search-bar input:focus { outline:none; border-color: var(--color-accent); box-shadow:0 0 0 2px rgba(37,99,235,.25); }
.search-bar button.clear { position:absolute; right:6px; top:6px; height:30px; background: var(--color-border); border:none; color: var(--color-text-soft); padding:0 10px; border-radius: var(--radius-sm); font-size:.75rem; font-weight:600; }
.search-bar button.clear:hover { background: var(--color-border-strong); }

.nav-group { background: var(--color-surface); border:1px solid var(--color-border); padding:14px 16px 18px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); }
.nav.controls button { background: var(--color-accent); }
.nav.controls button[disabled] { background: var(--color-border); color: var(--color-text-soft); }
.nav.controls .status { font-size:.75rem; letter-spacing:.5px; background: var(--color-accent-soft); color: var(--color-accent); padding:6px 10px; border-radius: var(--radius-pill); }

.footer { grid-column:1 / -1; text-align:center; margin-top:40px; font-size:.75rem; color: var(--color-text-soft); }

.flash-enter { animation: flashIn .9s ease; }
@keyframes flashIn { 0% { background: var(--color-accent-soft); } 100% { background:transparent; } }

.badge { background: var(--color-accent); color:#fff; padding:2px 6px; border-radius: var(--radius-xs); font-size:.6rem; font-weight:600; letter-spacing:.5px; }

.empty-state { padding:30px 24px; text-align:center; border:2px dashed var(--color-border); border-radius: var(--radius-md); background: linear-gradient(145deg,var(--color-surface),rgba(255,255,255,0.7)); }
.empty-state h2 { font-size:1.1rem; margin:0 0 8px; }
.empty-state p { margin:0; font-size:.8rem; color: var(--color-text-soft); }
.empty-state .file-hint { margin-top:12px; font-size:.72rem; opacity:0.8; }
.empty-state .file-hint code { white-space: nowrap; }

/* Utility */
.flex { display:flex; }
.flex-col { flex-direction:column; }
.gap-sm { gap:8px; }
.gap-md { gap:16px; }
.gap-lg { gap:28px; }
.mt-md { margin-top:16px; }
.mt-lg { margin-top:32px; }
.hidden { display:none !important; }
.text-soft { color: var(--color-text-soft); }
.mono { font-family: var(--font-mono); }

/* Main content constraints to avoid horizontal overflow */
.main-content { 
  min-width:0; 
  overflow-x:hidden;
  overflow-y:visible;
}
.main-content .panel { max-width:100%; }
.main-content .scroll-area { max-width:100%; }

/* Back to top button */
.back-to-top {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  border: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 100;
  opacity: 0.85;
  transition: all 0.3s ease;
  animation: fadeIn 0.3s ease;
}

.back-to-top:hover {
  transform: translateY(-5px);
  opacity: 1;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

.back-to-top:active {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 0.85; transform: translateY(0); }
}

/* Dark mode subtle tweaks */
@media (prefers-color-scheme: dark) {
	.code-block, pre { border-color: var(--color-border-strong); }
	.panel { border-color: var(--color-border-strong); }
	.message-card { border-color: var(--color-border-strong); }
	.fn-call-list li { border-color: var(--color-border-strong); }
	.nav-group { border-color: var(--color-border-strong); }
	.search-bar input { border-color: var(--color-border-strong); }
	
	.nav-status-center {
		background: rgba(30, 39, 49, 0.9);
		box-shadow: 0 4px 12px rgba(0,0,0,0.3);
	}
	
	.nav-group-label {
		background: rgba(30, 39, 49, 0.9);
		border-color: var(--color-border-strong);
	}
	
	.nav-all-btn {
		background: #1d4ed8;
	}
	
	.nav-filtered-btn {
		background: #047857;
	}
	
	.back-to-top {
		background: #1e40af;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
	}
	
	.back-to-top:hover {
		box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
	}
}
